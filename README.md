# **SPlot**

Функционал отображения диаграммы рассеяния скаттерплот средствами WebGL. Сторонние библиотеки не используются. Алгоритм работы позволяет корректно отображать десятки миллионов объектов. График можно двигать и зумировать мышью/трекпадом. Каждый отображаемый объект кроме места расположения может иметь индивидуальную форму, размер и цвет.

# Руководство

## Подключение

```js
import SPlot from 'splot'
```

## Использование

Экземпляр класса привязывается к существующему в документе канвасу по идентификатору. Настройка происходит передачей опций (в примерах - переменная `options`) одним из перечисленных ниже способов. Результатом будет отрисовка на канвасе скаттерплота.

```js
// Способ с разделением этапов создания, настройки и отрисовки.

let splot = new SPlot('canvas-id')
splot.setup(options)
splot.run()
```

```js
// Способ с объединением этапа создания и настройки.

let splot = new SPlot('canvas-id', options)
splot.run()
```

```js
// Способ с объединением этапов создания, настройки и отрисовки. Требуется указание соответствующего параметра в опциях.

let splot = new SPlot('canvas-id', options)
```

```js
// Вариант предварителного формирования опций для предыдущего примера.

let options = {
  iterator: readNextObject,
  colors: ['#ff0000', '#00ff00', '#0000ff'],
  grid: {
    width: 20_000,
    height: 10_000
  },
  forceRun: true
}
```
## Опции

Опции экземпляра передаются объектом в json-стилистике. Основной параметр опций - данные об объектах скаттерплота (расположение, форма, размер и цвет точек). Загрузить в скаттерплот данные об объектах можно двумя способами.

1. Задание в опциях параметра `iterator`. В качестве значения передается итерирующая функция.

2. Задание в опциях параметра `data`. В качестве значения передается готовый массив с данными об объектах.

Для корректной работы скаттерплота во время его первой настройки необходимо использовать один из этих способов загрузки данных. При повторных настройках задание способа загрузки требуется только если параметр `loadData` установлен в значение `true`.

Если будут заданы одновременно оба способа загрузки данных, то данные будут загружаться из массива.

> Для удобства описания составные параметры указаны в таблице через точку. Однако передавать опции экземпляру класса необходимо в развернутой json-стилистике как в предыдущем примере.

| Параметр | Default | Описание |
| - | - |- |
| `iterator` | `undefined` | Итерирующая функция. Каждый вызов этой функции должен возвращать либо данные об очередном объекте, либо null, если все объекты обработаны. Данные об объекте должны возвращаться в виде [записи](#Данные-об-объекте). |
| `data` | `undefined` | Массив с данными об объектах. Каждый элемент массива должен быть [записью](#Структура) специального вида. |
| `colors` | `[ ]` | Цветовая палитра объектов в виде массива строк. Каждая строка - это HEX-запись цвета. Индексы этого массива используются в [данных](#Структура) об объектах. Обязательный параметр для первичной настройки скаттерплота. |
| `grid {}` |  | Параметры координатной плоскости. Плоскость скаттерплота не привязана к размеру канваса и может значительно его превышать. При этом в зависимости от текущей степени зумирования пользователь будет видеть на канвасе либо всю плоскость, либо ее часть. |
| `grid.width` | `32_000`  | Ширина скаттерплота в пикселях. |
| `grid.height` | `16_000`  | Высота скаттерплота в пикселях. |
| `grid.bgColor` | `"#ffffff"`  | Фоновый цвет скаттерплота в HEX-формате. Следует делать его равным фоновому цвету канваса. |
| `grid.rulesColor` | `"#c0c0c0"`  | Цвет направляющих координатной плоскости скаттерплота в HEX-формате. |
| `forceRun` | `false`  | Признак форсированного запуска рендера. Если значение параметра будет `true`, то скаттерплот будет запущен сразу же после применения опций. |
| `globalLimit` | `1_000_000_000`  | Максимальное количество объектов, которое будет отображать скаттерплот. Если в процессе загрузки данных об объектах будет превышен этот лимит, то оставшиеся объекты не попадут в скаттерплот. |
| `groupLimit` | `10_000`  | Количество объектов, которые будут храниться в каждой группе видеобуферов. Менять значение по умолчанию имеет смысл только с целью экспериментов. |
| `camera {}` |  | Начальное состояние видимости плоскости скаттерплота на канвасе. |
| `camera.x` | `16_000`  | Положение области просмотра по оси X. |
| `camera.y` | `8_000`  | Положение области просмотра по оси Y. |
| `camera.zoom` | `1`  | Условное значение зумирования скаттерплота. Может изменяться в пределах от 0.02 до 200 единиц. |
| `loadData` | `true`  | Признак необходимости загрузки данных в скаттерплот. Для первичной настройки скаттерплота загрузка данных является обязательной. При последующих настройках и необходимости новой загрузки данных этот параметр должен быть принудительно установлен в значение `true`, т.к. после каждой загрузки данных скаттерплот сбрасывает его значение в `false`, чтобы не загружать данные повторно. |
| `demo {}` |  | Параметры режима демонстрационных данных. В этом режиме параметры `iterator`, `data` и `colors` игнорируются. Скаттерплот формирует и загружает искусственно сгенерированные объекты со случайными характеристиками. |
| `demo.isEnable` | `false`  | Признак включения демо-режима. |
| `demo.amount` | `1_000_000`  | Количество демо-объектов. |
| `demo.sizeMin` | `10`  | Минимальный размер демо-объектов. |
| `demo.sizeMax` | `30`  | Максимальный размер демо-объектов. |
| `demo.colors` | `["#D81C01", "#E9967A", "#BA55D3", "#FFD700", "#FFE4B5", "#FF8C00", "#228B22", "#90EE90", "#4169E1", "#00BFFF", "#8B4513", "#00CED1"]`  | Цветовая палитра демо-объектов в виде массива строк, описывающих цвета в HEX-формате. |
| `debug {}` |  | Параметры режима отладки. В этом режиме в консоль браузера выводится подробная техническая информация о данных и процессах скаттерплота. В этом режиме производительность скаттерплота значительно снижается. |
| `debug.isEnable` | `zzzzz`  | Признак включения режима отладки. |
| `debug.headerStyle` | `"font-weight: bold; color: #ffffff; background-color: #cc0000;"`  | CSS-стиль основного заголовка режима отладки в виде строки. |
| `debug.groupStyle` | `"font-weight: bold; color: #ffffff;"`  | CSS-стиль заголовка группы параметров режима отладки в виде строки. |
| `webgl {}` |  | Параметры создания контекста рендеринга WebGL. По умолчанию настроены на максимальную производительность графики. Параметры используются только при первой настройке скаттерплота, т.к. контекст рендеринга создается только один раз. Менять значения по умолчанию имеет смысл только с целью экспериментов. |
| `webgl.alpha` | `false`  | Наличие альфа-канала. |
| `webgl.depth` | `false`  | Наличие буфера глубины. |
| `webgl.stencil` | `false`  | Наличие буфера-трафарета. |
| `webgl.antialias` | `false`  | Режим сглаживания. |
| `webgl.desynchronized` | `true`  | Десонхронизация механизма растеризации канваса. |
| `webgl.premultipliedAlpha` | `false`  | Предварительное вычисление альфа-канала. |
| `webgl.preserveDrawingBuffer` | `false`  | Предотвращение автоматической очистки буферов. |
| `webgl.failIfMajorPerformanceCaveat` | `true`  | Попытка создания контекста с максимальной производительностью. |
| `webgl.powerPreference` | `"high-performance"`  | Тип энергоэффектиноости. Может принимать три значения: `default`, `high-performance`, `low-power`. |



- [Спецификация WebGL 1.0](https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.2)

- [Документация GLSL](https://www.khronos.org/registry/OpenGL/specs/gl/)

- [Шейдерная песочница](https://www.shadertoy.com/new)
